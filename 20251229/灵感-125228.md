# 灵感笔记 - {2025-12-29}

## 💡 创意点

## ⚠️ 遇到的问题
1.希望通过安装了tailscale的手机共享的网络访问其他已经接入tailscale的电脑，经测试失败了
  1.从技术实现上，只要共享网络的设备能将数据包转发给Tailscale虚拟网卡，那么就可以实现。但由于移动设备没有Root权限，无法建立转发规则，所以无法实现。
  2.在手机上，通过热点、usb共享网络都是共享默认出口，而不是共享虚拟网卡的出口，即访问100.x.x.x的IP地址不会导向虚拟网卡而导致失败。
```mermaid
  flowchart TD
    subgraph A[手机内部网络栈]
        direction LR
        Net[蜂窝网络/默认出口<br>（如 rmnet_data0）]
        VNIC[Tailscale虚拟网卡<br>（tailscale0）]
        Hotspot[热点虚拟接口<br>（如 ap0）]
        USB[USB共享接口<br>（如 rndis0）]
    end

    A1[“电脑A<br>（连接手机热点）”] --> Hotspot
    A2[“电脑B<br>（连接手机USB）”] --> USB

    Hotspot --> Router[“手机路由与防火墙<br>（关键：流量默认导向 Net，而非 VNIC）”]
    USB --> Router

    Router --> Net
    Router -.->|“❌ 缺失的转发规则<br>（无Root权限无法建立）”| VNIC

    Net --> Internet
    VNIC --> Tailnet[Tailscale虚拟网络<br>其他设备 100.x.x.x]
```

## ✅ 解决方案

## 📚 学到的知识

### 代理和vpn的区别

#### 代理和VPN在原理上的区别
1.代理运行在应用层，他拦截应用的请求，根据规则，将部分合规的请求转发给代理服务器，代理服务器再把请求转发给目标服务器。
2.VPN运行在传输层，他拦截网络数据包，他会直接获取目的的ip地址，当他目的地址在特定的网段，则会将转发给特定的虚拟网卡，先尝试在设备间建立点对点加密隧道。只有在NAT穿透失败时，才会使用备用的DERP中继服务器。
3.在性能上，VPN比代理要高，因为VPN不需要应用层拦截，不受代理服务器的带宽限制，直接将数据包转发给虚拟网卡，虚拟网卡再通过nat或者转发给tailscale服务器进行中转。
4.在安全性上，VPN比代理要高，因为VPN需要加密数据包，防止数据被监听。
5.在协议上，vpn支持所有协议，代理根据主动选择的协议进行代理，socket代理性能更高，https理论代理性能更差。
~~~~mermaid
flowchart LR
    subgraph VPNSG[VPN/Tailscale 模式]
        direction LR
        AppA[应用程序] --> OS[操作系统]
        OS -->|“1. 路由决策: 目标IP属于远程网段<br>2. 流量被定向至虚拟网卡”| VNIC[虚拟网卡]
        VNIC -->|“3. 整个数据包被加密<br>（形成隧道）”| Tunnel[VPN加密隧道]
        Tunnel -->|“4. 解密后，发往<br>目标网络”| Remote[远程内网设备]
    end

    subgraph ProxySG[代理模式]
        direction LR
        AppB[应用程序<br>（需配置代理）] -->|“1. 主动将请求<br>发送至代理服务器”| ProxySvr[代理服务器]
        ProxySvr -->|“2. 代表应用程序<br>向目标发起请求”| Internet[互联网资源]
    end
~~~~

1.https和http代理必须解析，增加了处理流程，性能更差。
2.socket代理不需要解析，性能更高。
3.vpn和代理的传输协议不同，vpn支持所有协议，代理根据主动选择的协议进行代理。
```mermaid
flowchart TD
    subgraph NetworkStack[网络协议栈 自上而下]
        direction TB
        L7[“应用层 L7<br>例如: HTTP, FTP, SMTP”]
        L5[“会话层 L5<br>例如: SOCKS”]
        L3[“网络层 L3<br>例如: IP”]
    end

    L7 -->|“数据流向”| L5 -->|“数据流向”| L3

    subgraph Proxies[“不同层级的‘代理’技术”]
        AppProxy[“应用层代理<br>（如 HTTP Proxy）”]
        SocksProxy[“会话层代理<br>（如 SOCKS5 Proxy）”]
        VPNTunnel[“网络层隧道<br>（如 VPN/Tailscale）”]
    end

    L7 -- “处理对象：特定应用协议的消息<br>（如 HTTP请求头、邮件正文）” --> AppProxy
    L5 -- “处理对象：传输层会话<br>（目标地址+端口+原始数据流）” --> SocksProxy
    L3 -- “处理对象：原始IP数据包<br>（包含目标IP、协议类型和全部负载）” --> VPNTunnel

    AppProxy --> SupportScope[“支持的协议<br>（有限，仅特定应用层协议）”]
    SocksProxy --> SupportScope2[“支持的协议<br>（广泛，任何基于TCP/UDP的协议）”]
    VPNTunnel --> SupportScope3[“支持的协议<br>（全部，所有基于IP的协议”）]
```
